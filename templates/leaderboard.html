<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RKSIBET ‚Äî –õ–∏–¥–µ—Ä–±–æ—Ä–¥</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<style>
body {
    margin:0;
    padding:0;
    background:#050505;
    color:#0ff;
    font-family:'Press Start 2P', monospace;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    overflow:hidden;
    position:relative;
}


/* –¢–∞–±–ª–∏—Ü–∞ */
table {
    border-collapse:collapse;
    width:70%;
    max-width:900px;
    text-align:center;
    background:#111;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 0 30px rgba(0,255,255,0.3);
    animation: fadeIn 1s ease;
}

@keyframes fadeIn {
    0% {opacity:0; transform: translateY(-50px);}
    100% {opacity:1; transform: translateY(0);}
}

th, td {
    padding:20px;
    border-bottom:1px solid #0ff;
    transition: all 0.3s ease;
}

th {
    background:#222;
    font-size:1.3em;
    color:#0ff;
    text-shadow:0 0 5px #0ff;
}

td {
    font-size:1.2em;
}

/* –ú–µ–¥–∞–ª–∏ */
.medal {
    font-size:2em;
    animation: medalBounce 0.6s ease;
}

@keyframes medalBounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

/* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π */
.highlight {
    animation: highlight 0.7s ease;
}

@keyframes highlight {
    0% { background:#0ff; color:#000; }
    100% { background:#111; color:#0ff; }
}

/* Hover –Ω–∞ —Å—Ç—Ä–æ–∫–∏ */
tr:hover {
    background:rgba(0,255,255,0.1);
    transform:scale(1.02);
    transition:0.3s;
}
</style>
</head>
<body>

<div id="dvd-logo"></div>

<h1>–õ–∏–¥–µ—Ä–±–æ—Ä–¥ RKSIBET</h1>

<table id="leaderboard">
<tr>
    <th>–ú–µ—Å—Ç–æ</th>
    <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
    <th>–ë–∞–ª–ª—ã</th>
</tr>
{% for l in leaderboard %}
<tr id="lb-{{ l.name }}">
    <td>
        {% if loop.index == 1 %}<span class="medal">ü•á</span>
        {% elif loop.index == 2 %}<span class="medal">ü•à</span>
        {% elif loop.index == 3 %}<span class="medal">ü•â</span>
        {% else %}{{ loop.index }}
        {% endif %}
    </td>
    <td>{{ l.name }}</td>
    <td>{{ l.total }}</td>
</tr>
{% endfor %}
</table>

<script>
let ws;
function connectWebSocket() {
    ws = new WebSocket("ws://"+location.host+"/ws");
    
    ws.onopen = () => console.log("WebSocket connected");
    ws.onclose = () => {
        console.log("WebSocket disconnected, reconnecting...");
        setTimeout(connectWebSocket, 1000);
    };
    ws.onerror = (err) => console.log("WebSocket error:", err);
    ws.onmessage = handleMessage;
}
connectWebSocket();

function handleMessage(event) {
    let data = JSON.parse(event.data);
    if(data.type === 'score_update'){
        data.leaderboard.forEach((l, i) => {
            let row = document.getElementById(`lb-${l.name}`);
            if(row){
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Å—Ç–æ
                let medal = '';
                if(i === 0) medal = 'ü•á';
                else if(i === 1) medal = 'ü•à';
                else if(i === 2) medal = 'ü•â';
                else medal = (i+1).toString();
                row.cells[0].innerText = medal;

                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–ª—ã
                row.cells[2].innerText = l.total;

                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                row.classList.add('highlight');
                setTimeout(()=>row.classList.remove('highlight'),700);
            }
        });
    }
}
</script>
</body>
</html>
