<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RKSIBET ‚Äî –õ–∏–¥–µ—Ä–±–æ—Ä–¥</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/leaderboard.css') }}">
</head>
<body>

<div id="dvd-logo"></div>

<h1 id="banner">–õ–∏–¥–µ—Ä–±–æ—Ä–¥ RKSIBET</h1>

<table id="leaderboard">
<tr>
    <th>–ú–µ—Å—Ç–æ</th>
    <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
    <th>–ë–∞–ª–ª—ã</th>
</tr>
{% for l in leaderboard %}
<tr id="lb-{{ l.name }}">
    <td>
        {% if loop.index == 1 %}<span class="medal">ü•á</span>
        {% elif loop.index == 2 %}<span class="medal">ü•à</span>
        {% elif loop.index == 3 %}<span class="medal">ü•â</span>
        {% else %}{{ loop.index }}
        {% endif %}
    </td>
    <td>{{ l.name }}</td>
    <td>{{ l.total }}</td>
</tr>
{% endfor %}
</table>

<script>
let ws;
function connectWebSocket() {
    ws = new WebSocket("ws://"+location.host+"/ws");
    
    ws.onopen = () => console.log("WebSocket connected");
    ws.onclose = () => {
        console.log("WebSocket disconnected, reconnecting...");
        setTimeout(connectWebSocket, 1000);
    };
    ws.onerror = (err) => console.log("WebSocket error:", err);
    ws.onmessage = handleMessage;
}
connectWebSocket();

function handleMessage(event) {
    let data = JSON.parse(event.data);
    if(data.type === 'score_update'){
        data.leaderboard.forEach((l, i) => {
            let row = document.getElementById(`lb-${l.name}`);
            if(row){
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Å—Ç–æ
                let medal = '';
                if(i === 0) medal = 'ü•á';
                else if(i === 1) medal = 'ü•à';
                else if(i === 2) medal = 'ü•â';
                else medal = (i+1).toString();
                row.cells[0].innerText = medal;

                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–ª—ã
                row.cells[2].innerText = l.total;

                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                row.classList.add('highlight');
                setTimeout(()=>row.classList.remove('highlight'),700);
            }
        });
    }
}
</script>
</body>
</html>
