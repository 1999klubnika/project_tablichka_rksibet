<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>RKSIBET — Оценки участников</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<style>
body {
    margin:0;
    padding:0;
    background:#050505;
    color:#0ff;
    font-family:'Press Start 2P', monospace;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
    overflow:hidden;
    position:relative;
}

/* Кнопка на главную */
#home-btn {
    position:absolute;
    top:20px;
    right:20px;
    padding:12px 20px;
    background:#0ff;
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-weight:bold;
    border:none;
    border-radius:5px;
    cursor:pointer;
    transition:0.3s;
}
#home-btn:hover {
    background:#00cccc;
    box-shadow:0 0 15px rgba(0,255,255,0.5);
}

/* Кнопка перейти к лидерборду */
#leaderboard-btn {
    position:absolute;
    top:20px;
    left:20px;
    padding:12px 20px;
    background:#0ff;
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-weight:bold;
    border:none;
    border-radius:5px;
    cursor:pointer;
    transition:0.3s;
}
#leaderboard-btn:hover {
    background:#00cccc;
    box-shadow:0 0 15px rgba(0,255,255,0.5);
}

/* Заголовок */
h1 {
    margin:20px 0;
    font-size:3em;
    font-family:'Orbitron', sans-serif;
    text-shadow:0 0 10px #0ff, 0 0 20px #0ff, 0 0 40px #0ff;
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    0% { text-shadow:0 0 5px #0ff; }
    100% { text-shadow:0 0 20px #0ff,0 0 40px #0ff,0 0 60px #0ff; }
}

/* Таблица */
table {
    border-collapse:collapse;
    width:85%;
    max-width:1200px;
    text-align:center;
    background:#111;
    border-radius:20px;
    overflow:hidden;
    box-shadow:0 0 40px rgba(0,255,255,0.3);
    animation: fadeIn 1s ease;
    margin-bottom:50px;
}

@keyframes fadeIn {
    0% {opacity:0; transform: translateY(-50px);}
    100% {opacity:1; transform: translateY(0);}
}

th, td {
    padding:15px;
    border-bottom:1px solid #0ff;
    transition: all 0.3s ease;
}

th {
    background:#222;
    font-size:1.3em;
    color:#0ff;
    text-shadow:0 0 5px #0ff;
}

td {
    font-size:1.1em;
    position:relative;
}

/* Цвета баллов */
td div span {
    display:inline-block;
    padding:3px 6px;
    border-radius:5px;
    min-width:25px;
    font-weight:bold;
}

.score-0 { background:#222; color:#555; }
.score-1 { background:#440000; color:#ff5555; }
.score-2 { background:#552200; color:#ffaa55; }
.score-3 { background:#555500; color:#ffff55; }
.score-4 { background:#225500; color:#55ff55; }
.score-5 { background:#00aa00; color:#00ff00; }

/* Подсветка обновлений */
.highlight {
    animation: pulse 0.7s ease;
}

@keyframes pulse {
    0% { transform:scale(1); box-shadow:0 0 5px #0ff; }
    50% { transform:scale(1.2); box-shadow:0 0 20px #0ff; }
    100% { transform:scale(1); box-shadow:0 0 5px #0ff; }
}

/* Hover tooltip */
td:hover::after {
    content: attr(data-jury);
    position:absolute;
    top:-30px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,255,255,0.8);
    color:#000;
    padding:3px 8px;
    border-radius:5px;
    font-size:0.7em;
    white-space:nowrap;
    opacity:1;
    transition:opacity 0.3s ease;
}

/* Hover на строки */
tr:hover {
    background:rgba(0,255,255,0.1);
    transform:scale(1.02);
    transition:0.3s;
}
</style>
</head>
<body>

<a id="leaderboard-btn" href="{{ url_for('leaderboard') }}">Перейти к Лидерборду</a>
<a id="home-btn" href="{{ url_for('leaderboard') }}">На главную</a>

<h1>Оценки участников RKSIBET</h1>

<table id="score-table">
<tr>
    <th>Участник</th>
    {% for j in jury_list %}
    <th>{{ j.name }}</th>
    {% endfor %}
</tr>
{% for p in participants %}
<tr id="row-{{ p.id }}">
    <td>{{ p.name }}</td>
    {% for j in jury_list %}
    <td id="cell-{{ p.id }}-{{ j.id }}" data-jury="{{ j.name }}">
        <div>
            <span class="score-{{ scores[p.id][j.id]['contest1'] }}">{{ scores[p.id][j.id]['contest1'] }}</span> /
            <span class="score-{{ scores[p.id][j.id]['contest2'] }}">{{ scores[p.id][j.id]['contest2'] }}</span> /
            <span class="score-{{ scores[p.id][j.id]['contest3'] }}">{{ scores[p.id][j.id]['contest3'] }}</span>
        </div>
    </td>
    {% endfor %}
</tr>
{% endfor %}
</table>

<script>
let ws;
function connectWebSocket() {
    ws = new WebSocket("ws://"+location.host+"/ws");
    
    ws.onopen = () => console.log("WebSocket connected");
    ws.onclose = () => setTimeout(connectWebSocket, 1000);
    ws.onerror = (err) => console.log("WebSocket error:", err);
    ws.onmessage = handleMessage;
}
connectWebSocket();

function handleMessage(event) {
    let data = JSON.parse(event.data);
    if(data.type === 'score_update'){
        for(let p_id in data.scores){
            for(let j_id in data.scores[p_id]){
                let cell = document.getElementById(`cell-${p_id}-${j_id}`);
                if(cell){
                    let vals = data.scores[p_id][j_id];
                    cell.innerHTML = `
                        <div>
                            <span class="score-${vals.contest1}">${vals.contest1}</span> /
                            <span class="score-${vals.contest2}">${vals.contest2}</span> /
                            <span class="score-${vals.contest3}">${vals.contest3}</span>
                        </div>
                    `;
                    cell.classList.add('highlight');
                    setTimeout(()=>cell.classList.remove('highlight'),700);
                }
            }
        }
    }
}
</script>

</body>
</html>